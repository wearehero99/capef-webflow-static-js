<div id="preloader" class="preloader"
    style="display: none; opacity: 1; position: fixed; top: 0px; left: 0px; width: 100%; height: 100%;">
    <div id="loading-icon" class="preloader-icon" data-w-id="f44246bf-1688-1f9e-43aa-830efb35cae2"
        data-animation-type="lottie"
        data-src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63f78657fa49428448175559_preloader-animation.json"
        data-loop="1" data-direction="1" data-autoplay="1" data-is-ix2-target="0" data-renderer="svg"
        data-default-duration="2.125" data-duration="0"
        style="background: rgb(40, 52, 62); padding: 10px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 2px 4px;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 715 715" width="715" height="715"
            preserveAspectRatio="xMidYMid meet"
            style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
            <defs>
                <clipPath id="__lottie_element_2">
                    <rect width="715" height="715" x="0" y="0"></rect>
                </clipPath>
            </defs>
            <g clip-path="url(#__lottie_element_2)">
                <g transform="matrix(0.9536333084106445,-0.3009708821773529,0.3009708821773529,0.9536333084106445,357.5,357.5)"
                    opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="42.410349279439124"
                            d=" M0,-324.8429870605469 C0,-324.8429870605469 0,-220.16400146484375 0,-220.16400146484375">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="0.8821708672936097"
                            d=" M227.46099853515625,-231.11500549316406 C227.46099853515625,-231.11500549316406 153.44200134277344,-157.0959930419922 153.44200134277344,-157.0959930419922">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="1.477966017885059"
                            d=" M322.02398681640625,-4 C322.02398681640625,-4 217.3459930419922,-4 217.3459930419922,-4">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="2.385655071293044"
                            d=" M228.29600524902344,223.46099853515625 C228.29600524902344,223.46099853515625 154.27699279785156,149.44200134277344 154.27699279785156,149.44200134277344">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="4.12617847858219"
                            d=" M1.180999994277954,318.02398681640625 C1.180999994277954,318.02398681640625 1.180999994277954,213.3459930419922 1.180999994277954,213.3459930419922">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="7.384143753637943"
                            d=" M-226.2790069580078,224.29600524902344 C-226.2790069580078,224.29600524902344 -152.26100158691406,150.27699279785156 -152.26100158691406,150.27699279785156">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="15.81224557906399"
                            d=" M-320.8429870605469,-2.819000005722046 C-320.8429870605469,-2.819000005722046 -216.16400146484375,-2.819000005722046 -216.16400146484375,-2.819000005722046">
                        </path>
                    </g>
                </g>
                <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                    <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                        <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0" stroke="rgb(255,255,255)"
                            stroke-opacity="1" stroke-width="52.01214879377651"
                            d=" M-227.11500549316406,-230.2790069580078 C-227.11500549316406,-230.2790069580078 -153.0959930419922,-156.25999450683594 -153.0959930419922,-156.25999450683594">
                        </path>
                    </g>
                </g>
            </g>
        </svg>
    </div>
</div>

<div data-current="Tab 1" data-easing="ease" data-duration-in="300" data-duration-out="100" class="w-tabs">
    <div class="tab-container-center w-tab-menu" role="tablist"><a id="atendimento-presencial-input" data-w-tab="Tab 1"
            class="tab-link-form _02 w-inline-block w-tab-link w--current" href="#w-tabs-0-data-w-pane-0" role="tab"
            aria-controls="w-tabs-0-data-w-pane-0" aria-selected="true">
            <div class="tab-container">
                <div class="icon-tab-container ico-01"><img loading="lazy"
                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63f6f063c40da5ef7581fd59_ico.svg"
                        alt="" class="icon-tab"></div>
                <div class="text-tab">
                    <div class="text-align-center">
                        <div>Atendimento Presencial</div>
                    </div>
                </div>
            </div>
        </a><a id="atendimento-eletronico-input" data-w-tab="Tab 2" class="tab-link-form _02 w-inline-block w-tab-link"
            tabindex="-1" href="#w-tabs-0-data-w-pane-1" role="tab" aria-controls="w-tabs-0-data-w-pane-1"
            aria-selected="false">
            <div class="tab-container">
                <div class="icon-tab-container ico-02"><img loading="lazy"
                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63f6f063c40da5493481fd58_ico-1.svg"
                        alt="" class="icon-tab"></div>
                <div class="text-tab">
                    <div class="text-align-center">
                        <div>Atendimento eletrônico</div>
                    </div>
                </div>
            </div>
        </a></div>
    <div class="w-tab-content">
        <div data-w-tab="Tab 1" class="w-tab-pane w--tab-active" id="w-tabs-0-data-w-pane-0" role="tabpanel"
            aria-labelledby="atendimento-presencial-input">
            <div class="container-form-tab">
                <div>
                    <div class="tab-titlle">
                        <div class="heading-style-h6">Atendimento Presencial</div>
                    </div>
                </div>
                <div class="w-form">
                    <div class="padding-small"></div>
                    <div class="padding-small"></div>
                    <div class="c-input-form">
                        <div class="input-grid _3fr">
                            <div class="c-input-tab"><label for="dia-input"
                                    class="c-text cc-field-header">Dia</label><select id="dia-input" name="dia-input"
                                    data-name="dia-input" required="" class="c-text-field w-select">
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select></div>
                            <div class="c-input-tab"><label for="mes-input"
                                    class="c-text cc-field-header">Mês</label><select id="mes-input" name="mes-input"
                                    data-name="mes-input" required="" class="c-text-field w-select">
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select></div>
                            <div class="c-input-tab"><label for="year-input"
                                    class="c-text cc-field-header">Ano</label><select id="year-input"
                                    name="time-input-3" data-name="Time Input 3" required=""
                                    class="c-text-field w-select">
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                </select></div>
                            <div class="c-input-tab"></div>
                        </div>
                    </div>
                    <div class="c-input-form">
                        <div class="input-grid _2fr">
                            <div class="c-input-tab"><label for="plan-input"
                                    class="c-text cc-field-header">Plano</label><select id="plan-input" name="plano"
                                    data-name="plano" required="" class="c-text-field w-select">
                                    <option value="1">Plano BD</option>
                                    <option value="2">Plano CV I</option>
                                </select></div>
                            <div class="c-input-tab desativar"><label for="field-2"
                                    class="c-text cc-field-header">Data</label>
                                <div class="c-text-field w-embed"><input class="input" type="date" id="date-input"
                                        name="appt" onchange="handleDateChange(event);">

                                    <style>
                                        .input {
                                            padding-top: 0.25rem;
                                            width: 100%;
                                            border: none;
                                            outline: none;
                                            background: none;
                                        }
                                    </style>
                                </div>
                            </div>
                            <div class="c-input-tab"><label for="time-input-2"
                                    class="c-text cc-field-header">Horário</label><select id="time-input-2"
                                    name="time-input-2" data-name="Time Input 2" required=""
                                    class="c-text-field w-select"></select></div>
                        </div>
                    </div>
                    <div class="c-input-form">
                        <div class="input-grid">
                            <div class="c-input-tab"><label for="email-input"
                                    class="c-text cc-field-header">e-mail</label><input type="text"
                                    class="c-text-field w-input" maxlength="256" name="email" data-name="email"
                                    placeholder="Insira seu e-mail" id="email-input" required=""></div>
                            <div class="c-input-tab"><label for="phone-01" class="c-text cc-field-header">DDD +
                                    Telefone</label><input type="text" class="c-text-field w-input" maxlength="16"
                                    name="phone" data-name="phone" placeholder="Insira seu telefone " id="phone-01"
                                    required=""></div>
                        </div>
                    </div>
                    <div class="c-input-form">
                        <div class="input-grid">
                            <div class="c-input-tab"><label for="cpf-01"
                                    class="c-text cc-field-header">CPF</label><input type="text"
                                    class="c-text-field w-input" maxlength="14" name="phone02" data-name="phone02"
                                    placeholder="Insira seu CPF" id="cpf-01" required=""></div>
                            <div class="c-input-tab"></div>
                            <div id="w-node-ea406dc6-0438-1eb8-0229-f187adca1535-2f5a80dc"
                                class="descripition-input-form">
                                <div>Digite o cpf somente com os números.</div>
                                <ul role="list">
                                    <li>Só é possível realizar agendamento se seu cpf estiver cadastrado em nosso
                                        banco de dados.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="tab-button-box"><button type="button" id="atendimento-presencial-submit" href="#"
                            class="button-6 button-full w-button">Enviar</button></div>
                    <div class="w-form-done" style="display: none;" tabindex="-1" role="region"
                        aria-label="Email Form success">
                        <div>Agendamento criado com sucesso.</div>
                    </div>
                    <div class="w-form-fail" tabindex="-1" role="region" aria-label="Email Form failure"
                        style="display: block;">Sem horarios disponível para está data</div>
                </div>
            </div>
        </div>
        <div data-w-tab="Tab 2" class="w-tab-pane" id="w-tabs-0-data-w-pane-1" role="tabpanel"
            aria-labelledby="atendimento-eletronico-input">
            <div class="container-form-tab">
                <div>
                    <div class="tab-titlle">
                        <div class="heading-style-h6">Atendimento Eletrônico</div>
                    </div>
                </div>
                <div class="w-form">
                    <div class="padding-small"></div>
                    <div class="padding-small"></div>
                    <div class="c-input-form">
                        <div class="input-grid _3fr">
                            <div class="c-input-tab"><label for="dia-input-2"
                                    class="c-text cc-field-header">Dia</label><select id="dia-input-2"
                                    name="dia-input-2" data-name="Dia Input 2" required=""
                                    class="c-text-field w-select">
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                    <option value="13">13</option>
                                    <option value="14">14</option>
                                    <option value="15">15</option>
                                    <option value="16">16</option>
                                    <option value="17">17</option>
                                    <option value="18">18</option>
                                    <option value="19">19</option>
                                    <option value="20">20</option>
                                    <option value="21">21</option>
                                    <option value="22">22</option>
                                    <option value="23">23</option>
                                    <option value="24">24</option>
                                    <option value="25">25</option>
                                    <option value="26">26</option>
                                    <option value="27">27</option>
                                    <option value="28">28</option>
                                    <option value="29">29</option>
                                    <option value="30">30</option>
                                    <option value="31">31</option>
                                </select></div>
                            <div class="c-input-tab"><label for="mes-input-2"
                                    class="c-text cc-field-header">Mês</label><select id="mes-input-2"
                                    name="mes-input-2" data-name="Mes Input 2" required=""
                                    class="c-text-field w-select">
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select></div>
                            <div class="c-input-tab"><label for="year-input-2"
                                    class="c-text cc-field-header">Ano</label><select id="year-input-2"
                                    name="time-input-3" data-name="Time Input 3" required=""
                                    class="c-text-field w-select">
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                </select></div>
                            <div class="c-input-tab"></div>
                        </div>
                    </div>
                    <div class="c-input-tab"><label for="assunto-input"
                            class="c-text cc-field-header">Assunto</label><select id="assunto-input" name="Assunto"
                            data-name="Assunto" required="" class="c-text-field w-select">
                            <option value="adesao">Adesão</option>
                            <option value="beneficio">Benefício </option>
                            <option value="cadastro">Cadastro</option>
                            <option value="contribuiçãoprevidenciaria ">Contribuição previdenciária </option>
                            <option value="cancelamento">Cancelamento </option>
                            <option value="emprestimo">Empréstimo </option>
                            <option value="financiamentoimobiliário ">Financiamento imobiliário </option>
                            <option value="impostoderenda">Imposto de renda </option>
                            <option value="institutosprevidenciarios">Institutos previdenciários </option>
                            <option value="processosdeadesaodoacordo">Processos de Adesão do acordo 2003</option>
                            <option value="recadastramento">Recadastramento </option>
                            <option value="outros">Outros</option>
                        </select></div>
                    <div class="c-input-form">
                        <div class="input-grid _2fr">
                            <div class="c-input-tab"><label for="plan-input-2"
                                    class="c-text cc-field-header">Plano</label><select id="plan-input-2" name="plano"
                                    data-name="plano" required="" class="c-text-field w-select">
                                    <option value="1">Plano BD</option>
                                    <option value="2">Plano CV I</option>
                                </select></div>
                            <div class="c-input-tab"><label for="horario-2"
                                    class="c-text cc-field-header">Horário</label><select id="horario-2" name="horario"
                                    data-name="horario" required="" class="c-text-field w-select"></select></div>
                        </div>
                    </div>
                    <div class="c-input-form">
                        <div class="input-grid">
                            <div class="c-input-tab"><label for="email-input-2"
                                    class="c-text cc-field-header">e-mail</label><input type="text"
                                    class="c-text-field w-input" maxlength="256" name="email" data-name="email"
                                    placeholder="Insira seu e-mail" id="email-input-2" required=""></div>
                            <div class="c-input-tab"><label for="phone-02" class="c-text cc-field-header">DDD +
                                    Telefone</label><input type="text" class="c-text-field w-input" maxlength="16"
                                    name="phone-2" data-name="Phone 2" placeholder="Insira seu telefone " id="phone-02"
                                    required=""></div>
                        </div>
                    </div>
                    <div class="c-input-form">
                        <div class="input-grid">
                            <div class="c-input-tab"><label for="cpf-02"
                                    class="c-text cc-field-header">CPF</label><input type="text"
                                    class="c-text-field w-input" maxlength="14" name="phone02" data-name="phone02"
                                    placeholder="Insira seu CPF" id="cpf-02" required=""></div>
                            <div class="c-input-tab"></div>
                            <div id="w-node-_05baabee-d14f-0157-dcca-c19118bc6941-2f5a80dc"
                                class="descripition-input-form">
                                <div>Digite o cpf somente com os números.</div>
                                <ul role="list">
                                    <li>Só é possível realizar agendamento se seu cpf estiver cadastrado em nosso
                                        banco de dados.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="tab-button-box"><button type="button" id="atendimento-eletronico-submit"
                            href="#electronico" class="button-6 button-full w-button">Enviar</button></div>

                    <div class="w-form-done" style="display: none;" tabindex="-1" role="region"
                        aria-label="Email Form success">
                        <div>Agendamento criado com sucesso.</div>
                    </div>
                    <div class="w-form-fail" tabindex="-1" role="region" aria-label="Email Form failure"
                        style="display: block;">Sem horarios disponível para está data</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
    integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.rawgit.com/wearehero99/capef-webflow-static-js/main/jquery-mask.js"></script>


<script>
    let tipoAtendimento = 1;


    async function setupToken() {

        const authResponse = await fetch("https://ici002.capef.com.br/apiagendamento/auth/access-token", {
            method: "POST",
            body: JSON.stringify({
                username: "Hero99",
                password: "d7OwsEqTXc"
            }),
            headers: {
                "Content-Type": "application/json"
            }
        });

        if (!authResponse.ok) {
            throw new Error("Failed to obtain authentication token");
        }

        const authData = await authResponse.json();
        token = authData.access_Token;
        localStorage.setItem('authToken', token);

    }

    async function authFetch(url, options = {}) {
        try {
            let token = localStorage.getItem('authToken');
            const headers = {
                ...options.headers,
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            };
            const dataResponse = await fetch(url, {
                ...options,
                headers
            });

            if (dataResponse.status === 401) {
                localStorage.removeItem("authToken");
                await setupToken();
                getTimesOfToday();
            }

            if (dataResponse.status === 400) {
                const result = await dataResponse.json();

                return {
                    status: dataResponse.status,
                    data: result[0]
                }
            }
            if (dataResponse.status === 204) {
                return {
                    status: dataResponse.status
                }
            }
            if (!dataResponse.ok) {
                if (dataResponse.status === 415) {

                } else

                    if (await dataResponse.json()) {
                        const result = await dataResponse.json();
                        return {
                            error: result[0],
                            status: dataResponse.status
                        }
                    } else {
                        return {
                            status: dataResponse.status
                        }
                    }
            } else {
                const data = await dataResponse.json();
                return data;
            }

        } catch (error) {
            return error
        }
    }


    function clearError() {
        $(".w-form-fail").css("display", "none");
        $(".w-form-fail").text("");
        $("#atendimento-presencial-submit, #atendimento-eletronico-submit").text("Enviar");
        preloader.style.display = "none";
    }
    const api = authFetch;
    var urlSchedule = "https://ici002.capef.com.br/apiagendamento";
    var urlCalend = "https://ici002.capef.com.br/apiagendamento";


    function showFormFailMessage(message) {
        $(".w-form-fail").css("display", "block");
        $(".w-form-fail").text(message);
    }

    function addMask() {
        $("#phone-01").mask("(99) 9 9999-9999");
        $("#phone-02").mask("(99) 9 9999-9999");
        $("#cpf-01").mask("999.999.999-99");
        $("#cpf-02").mask("999.999.999-99");
    };
    $(document).ready(function ($) {
        $("#phone-01").mask("(99) 9 9999-9999");
        $("#phone-02").mask("(99) 9 9999-9999");
        $("#cpf-01").mask("999.999.999-99");
        $("#cpf-02").mask("999.999.999-99");
    });

    const loadingIcon = document.getElementById("loading-icon");
    const preloader = document.getElementById("preloader");
    loadingIcon.style.background = "#28343e";
    loadingIcon.style.padding = "10px";
    loadingIcon.style.borderRadius = "6px";
    loadingIcon.style.boxShadow = "0px 0px 0px 1px rgba(0, 0, 0, 0.1), 0px 2px 4px rgba(0, 0, 0, 0.2)";
    if (preloader) {
        preloader.style.display = "none";
        preloader.style.opacity = 1;
        preloader.style.position = "fixed";
        preloader.style.top = 0;
        preloader.style.left = 0;
        preloader.style.width = "100%";
        preloader.style.height = "100%";
    }

    function getElement(selector) {
        return document.querySelector(selector);
    }

    async function getPlans() {
        const response = await api(`${urlSchedule}/plano`);
        const result = response;
        const planInput = $("#plan-input");
        const planInput2 = $("#plan-input-2");
        planInput.empty();
        planInput2.empty();
        $.each(result, function (index, value) {
            planInput.append("<option value='" + value.id + "'>" + value.descricao + "</option>");
            planInput2.append("<option value='" + value.id + "'>" + value.descricao + "</option>");
        });
        planInput.val(result[0].id);
        planInput2.val(result[0].id);
    }

    async function getTimes({
        day,
        year,
        month,
        atendimentoType
    }) {

        const timeInput = $("#time-input-2");
        const timeInput2 = $("#horario-2");


        timeInput.empty();
        timeInput2.empty();

        const attId = atendimentoType;
        try {
            const response = await api(`${urlCalend}/horarios/atendimento/${attId}/dia/${day}/mes/${month}/ano/${year}`);
            const data = response;
            if (data.status === 204) {
                showFormFailMessage("Sem horarios disponível para está data");
                return;
            } else {
                if (data.error) {
                    console.log("error ===> ", data.error);
                    return;
                }
                clearError();
                if (data.length) {
                    const horariosWithoutKeys = data.map(item => item.horarios);

                    timeInput.empty();
                    timeInput2.empty();

                    $.each(horariosWithoutKeys, function (index, value) {
                        timeInput.append("<option value='" + value + "'>" + value + "</option>");
                        timeInput2.append("<option value='" + value + "'>" + value + "</option>");

                    });
                    timeInput2.val(horariosWithoutKeys[0]);
                    timeInput.val(horariosWithoutKeys[0]);
                }
            }
        } catch (error) {
            console.log(error);
        }
    }

    async function checkCPF(cpf) {
        const response = await api(`${urlSchedule}/agendamento/validar/cpf/${cpf}`);
        const data = (await response).json();
    }



    function loadDaysOfMonth(selectElement, days) {

        selectElement.empty();

        for (let day in days) {
            const option = $("<option>").val(days[day]).text(days[day]);
            selectElement.append(option);
        }
    }

    function loadYears(selectElement, years) {

        selectElement.empty();

        for (let year in years) {
            const option = $("<option>").val(years[year]).text(years[year]);
            selectElement.append(option);
        }
    }

    function loadMonths(selectElement, months) {

        selectElement.empty();

        for (let month in months) {
            const monthStr = months[month].descricao.charAt(0).toUpperCase() + months[month].descricao.slice(1)
            const option = $("<option>").val(months[month].mes).text(monthStr);
            selectElement.append(option);
        }
    }



    async function loadCalendar() {
        const response = await api(`${urlSchedule}/calendario/atendimento/${tipoAtendimento}`);
        const result = response[0];

        const diaEleme = $("#dia-input");
        const diaEleme2 = $("#dia-input-2");

        const mesElem = $("#mes-input");
        const mesElem2 = $("#mes-input-2")

        const ano1 = $("#year-input");
        const ano2 = $("#year-input-2")

        loadDaysOfMonth(diaEleme, result.dias)
        loadDaysOfMonth(diaEleme2, result.dias)

        loadMonths(mesElem, result.mes)
        loadMonths(mesElem2, result.mes)

        loadYears(ano1, result.ano)
        loadYears(ano2, result.ano)

        getTimesOfToday()
    }

    loadCalendar()


    async function getTimesOfToday() {
        const day = $(tipoAtendimento === 1 ? "#dia-input" : "#dia-input-2").val();
        const month = $(tipoAtendimento === 1 ? "#mes-input" : "#mes-input-2").val();
        const year = $(tipoAtendimento === 1 ? "#year-input" : "#year-input-2").val();

        console.log(day, month, year)

        getTimes({
            day,
            year,
            month: month,
            atendimentoType: tipoAtendimento
        });
    }

    async function isAttendAlreadyExist({
        typeAtt,
        cpf
    }) {
        const response = await api(`${urlSchedule}/agendamento/existe/atendimento/${typeAtt}/cpf/${cpf}`);
        const result = response;

        if (result.status === 400) {
            clearError();
            showFormFailMessage("CPF não encontrado");
            return false;
        } else {
            clearError();
            const data = response;
            return true;
        }
    }
    async function scheduleAttend(data) {
        clearError();
        $("#atendimento-presencial-submit, #atendimento-eletronico-submit").prop("disabled", true);
        $("#atendimento-presencial-submit, #atendimento-eletronico-submit").text("carregando...");

        const response = await api(`${urlSchedule}/agendamento/criar`, {
            method: "POST",
            body: JSON.stringify(data)
        });


        console.log("response===> ", response)


        $("#atendimento-presencial-submit, #atendimento-eletronico-submit").prop("disabled", false);
        $("#atendimento-presencial-submit, #atendimento-eletronico-submit").text("Enviar");

        if (response.id) {
            $(".tab-button-box, .c-input-form, .c-input-form, .c-input-form, .c-input-tab, .c-input-form ").css("display", "none");
            $(".w-form-done").css("display", "block");
        } else {
            showFormFailMessage(response.data);
        }
    }

    function getElement(selector) {
        return document.querySelector(selector);
    }
    async function loadScript() {

        await setupToken();

        await loadCalendar()

        $("#dia-input, #mes-input, #year-input, #plan-input, #dia-input-2, #mes-input-2, #year-input-2, #plan-input-2").change(function () {
            clearError();
            const day = $(tipoAtendimento === 1 ? "#dia-input" : "#dia-input-2").val();
            const month = $(tipoAtendimento === 1 ? "#mes-input" : "#mes-input-2").val();
            const year = $(tipoAtendimento === 1 ? "#year-input" : "#year-input-2").val();


            getTimes({
                day,
                year,
                month: Number(month) + 1,
                atendimentoType: tipoAtendimento
            });
        });

        $("#atendimento-eletronico-input").click(async function () {
            clearError();
            addMask();
            await getPlans();
            tipoAtendimento = 2;
        });
        $("#atendimento-presencial-input").click(async function () {
            clearError();
            addMask();
            await getPlans();
            tipoAtendimento = 1;
        });
        getPlans();
        $("#dia-input, #mes-input, #year-input, #plan-input,#mes-input-2, #year-input-2, #plan-input-2, #phone-01,#phone-02, #time - input - 2, #email - input, #email - input - 2, #assunto - input").change(function () {
            clearError();
        })
    }

    loadScript();


    async function createRegistration() {
        clearError();
        const phoneValue = getElement(tipoAtendimento === 1 ? "#phone-01" : "#phone-02").value;
        const cpfInputValue = getElement(tipoAtendimento === 1 ? "#cpf-01" : "#cpf-02").value;
        const timeInputValue = getElement(tipoAtendimento === 1 ? "#time-input-2" : "#horario-2").value;
        const planInputValue = getElement(tipoAtendimento === 1 ? "#plan-input" : "#plan-input-2").value;
        const emailInputValue = getElement(tipoAtendimento === 1 ? "#email-input" : "#email-input-2").value;
        const assuntoInputValue = getElement("#assunto-input") ? getElement("#assunto-input").value : "";
        const day = getElement(tipoAtendimento === 1 ? "#dia-input" : "#dia-input-2").value;
        const month = getElement(tipoAtendimento === 1 ? "#mes-input" : "#mes-input-2").value;
        const year = getElement(tipoAtendimento === 1 ? "#year-input" : "#year-input-2").value;
        const phoneDDD = phoneValue.replace("(", "").replace(")", "").substring(0, 3);
        const phoneRest = phoneValue.replace("(", "").replace(")", "").substring(3);

        if (cpfInputValue && timeInputValue && planInputValue && emailInputValue && phoneValue) {

            preloader.style.display = "flex";

            const resultCPF = await isAttendAlreadyExist({
                cpf: cpfInputValue.replace(/\./g, "").replace("-", ""),
                typeAtt: tipoAtendimento
            });

            console.log("resultCPF", resultCPF)

            if (resultCPF) {

                const raw = {
                    ano: year,
                    dia: day,
                    mes: Number(month) + 1,
                    plano: planInputValue,
                    assunto: tipoAtendimento,
                    horario: timeInputValue,
                    cpf: cpfInputValue.replace(/\./g, "").replace("-", ""),
                    ddd: phoneDDD.replace(" ", ""),
                    telefone: phoneRest.replace(" ", "").replace("-", ""),
                    email: emailInputValue,
                    tipoAtendimento: tipoAtendimento,
                };

                await scheduleAttend(raw);

                preloader.style.display = "none";
            }
            $("#atendimento-presencial-submit, #atendimento-eletronico-submit").text("Enviar");

            preloader.style.display = "none";
            return;
        } else {
            showFormFailMessage("Todos os campos são obrigatórios");
            console.log("One or more input values are missing.");
            return;
        }
    }

    document.querySelector("#atendimento-presencial-submit").addEventListener("click", createRegistration);
    document.getElementById("atendimento-eletronico-submit").addEventListener("click", createRegistration);

</script>