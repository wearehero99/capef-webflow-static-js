<div class="container-date">
    <div class="normativosbd-section-docs">
        <div class="container-large">
            <div class="l-date">
                <div class="l-navegation"><a href="/" class="breadcrumb-link fonte-color-600">Capef</a>
                    <div class="text-block-16">/</div><a href="/sala-do-participante/sala-do-participante"
                        class="breadcrumb-link fonte-color-600">Sala do participante</a>
                    <div class="text-block-17">/</div><a href="#"
                        class="breadcrumb-link fonte-color-700">Aniversáriantes</a>
                </div>
                <div class="search-date">
                    <div class="form-date w-form">
                        <form id="email-form" name="email-form" data-name="Email Form" method="get" class="form-3"
                            aria-label="Email Form">
                            <div class="l-input-box"><input type="text" class="c-input_date w-input" maxlength="256"
                                    name="Pesquisar-por-nome" data-name="Pesquisar por nome"
                                    placeholder="Pesquisar por nome" id="Pesquisar-por-nome">
                                <div class="img-box"><img
                                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63d11dcb0352b05937ba5227_Icon%20Right.svg"
                                        loading="lazy" alt="" class="icon-1x1-medium icon-input_date"></div>
                            </div>
                            <div class="l-input-box date">
                                <div class="c-input_date w-embed"><select class="input" id="mes" name="mes"
                                        onchange="atualizarDias()">
                                        <option value="">Selecione um mês</option>
                                        <option value="1">Janeiro</option>
                                        <option value="2">Fevereiro</option>
                                        <option value="3">Março</option>
                                        <option value="4">Abril</option>
                                        <option value="5">Maio</option>
                                        <option value="6">Junho</option>
                                        <option value="7">Julho</option>
                                        <option value="8">Agosto</option>
                                        <option value="9">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>



                                    <style>
                                        .input {
                                            border: none;
                                            width: 100%;
                                            padding: 0 0.75rem;
                                            outline: none;
                                        }
                                    </style>
                                </div>
                                <div class="img-box"><img
                                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63d11dcb0352b04ddfba5228_Icon%20Right-1.svg"
                                        loading="lazy" alt="" class="icon-1x1-medium icon-input_date"></div>
                            </div>
                            <div class="l-input-box">
                                <div class="c-input_date w-embed"><select class="input" id="dia" name="dia">
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                        <option value="8">8</option>
                                        <option value="9">9</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                        <option value="13">13</option>
                                        <option value="14">14</option>
                                        <option value="15">15</option>
                                        <option value="16">16</option>
                                        <option value="17">17</option>
                                        <option value="18">18</option>
                                        <option value="19">19</option>
                                        <option value="20">20</option>
                                        <option value="21">21</option>
                                        <option value="22">22</option>
                                        <option value="23">23</option>
                                        <option value="24">24</option>
                                        <option value="25">25</option>
                                        <option value="26">26</option>
                                        <option value="27">27</option>
                                        <option value="28">28</option>
                                        <option value="29">29</option>
                                        <option value="30">30</option>
                                        <option value="31">31</option>
                                    </select>



                                    <style>
                                        .input {
                                            border: none;
                                            width: 100%;
                                            padding: 0 0.75rem;
                                            outline: none;
                                        }
                                    </style>
                                </div>
                                <div class="img-box"><img
                                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63d11dcb0352b04ddfba5228_Icon%20Right-1.svg"
                                        loading="lazy" alt="" class="icon-1x1-medium icon-input_date"></div>
                            </div>
                            <div class="htmk-buttom w-embed">
                                <button type="button" id="birthday-submit" class="btn" onclick()="">Pesquisar</button>

                            </div>
                        </form>
                        <div class="preloader"
                            style="display: none; opacity: 1; position: fixed; top: 0px; left: 0px; width: 100%; height: 100%;">
                            <div id="loading-icon" class="preloader-icon"
                                data-w-id="5da00c77-028c-7a6d-f520-93912d3191b6" data-animation-type="lottie"
                                data-src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/63f78657fa49428448175559_preloader-animation.json"
                                data-loop="1" data-direction="1" data-autoplay="1" data-is-ix2-target="0"
                                data-renderer="svg" data-default-duration="2.125" data-duration="0"
                                style="background: rgb(40, 52, 62); padding: 10px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 2px 4px;">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 715 715" width="715" height="715"
                                    preserveAspectRatio="xMidYMid meet"
                                    style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px);">
                                    <defs>
                                        <clipPath id="__lottie_element_2">
                                            <rect width="715" height="715" x="0" y="0"></rect>
                                        </clipPath>
                                    </defs>
                                    <g clip-path="url(#__lottie_element_2)">
                                        <g transform="matrix(0.9713878631591797,-0.23749873042106628,0.23749873042106628,0.9713878631591797,357.5,357.5)"
                                            opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="32.773138920507876"
                                                    d=" M0,-324.8429870605469 C0,-324.8429870605469 0,-220.16400146484375 0,-220.16400146484375">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="0.38403461385483695"
                                                    d=" M227.46099853515625,-231.11500549316406 C227.46099853515625,-231.11500549316406 153.44200134277344,-157.0959930419922 153.44200134277344,-157.0959930419922">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="0.7518911575808787"
                                                    d=" M322.02398681640625,-4 C322.02398681640625,-4 217.3459930419922,-4 217.3459930419922,-4">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="1.4000768576584193"
                                                    d=" M228.29600524902344,223.46099853515625 C228.29600524902344,223.46099853515625 154.27699279785156,149.44200134277344 154.27699279785156,149.44200134277344">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="2.6227489453878547"
                                                    d=" M1.180999994277954,318.02398681640625 C1.180999994277954,318.02398681640625 1.180999994277954,213.3459930419922 1.180999994277954,213.3459930419922">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="5.085525371182101"
                                                    d=" M-226.2790069580078,224.29600524902344 C-226.2790069580078,224.29600524902344 -152.26100158691406,150.27699279785156 -152.26100158691406,150.27699279785156">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="11.438248416856283"
                                                    d=" M-320.8429870605469,-2.819000005722046 C-320.8429870605469,-2.819000005722046 -216.16400146484375,-2.819000005722046 -216.16400146484375,-2.819000005722046">
                                                </path>
                                            </g>
                                        </g>
                                        <g transform="matrix(1,0,0,1,357.5,357.5)" opacity="1" style="display: block;">
                                            <g opacity="1" transform="matrix(1,0,0,1,0,0)">
                                                <path stroke-linecap="round" stroke-linejoin="round" fill-opacity="0"
                                                    stroke="rgb(255,255,255)" stroke-opacity="1"
                                                    stroke-width="34.34648309720528"
                                                    d=" M-227.11500549316406,-230.2790069580078 C-227.11500549316406,-230.2790069580078 -153.0959930419922,-156.25999450683594 -153.0959930419922,-156.25999450683594">
                                                </path>
                                            </g>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <div class="w-form-done" tabindex="-1" role="region" aria-label="Email Form success">
                            <div>Thank you! Your submission has been received!</div>
                        </div>
                        <div class="error-message w-form-fail" tabindex="-1" role="region"
                            aria-label="Email Form failure"></div>
                    </div>
                </div>
                <div class="c-divider"></div>
            </div>
        </div>
    </div>
    <div class="list-date">
        <div id="w-node-_94e69493-0372-70ee-c5b3-bec232e4a51b-2d19149b" class="c-date-tag">
            <div id="date-tag" class="c-date-tag powder-blue-01" style="width: 119px; display: none;">
                <div id="birthday-month" class="text-block-27">Outubro</div>
                <div id="birthday-day" class="text-block-26 w-node-_94e69493-0372-70ee-c5b3-bec232e4a51f-2d19149b">01
                </div>
            </div>
        </div>
        <div class="list-data-names">
            <ul id="birthday-list" role="list" class="list">
                <li class="list-item">
                    <div class="l-dot">
                        <div class="dot"></div>
                        <div class="l-name-list">
                            <div class="body-normal-600">Ligia Maria Carneiro Melo</div>
                            <div class="birthday-info">
                                <div class="birthday-date"><img class="date-icon"
                                        src="https://assets.website-files.com/639787ef2df6f2cf951c2cba/6423a6d521de6a4d059dd8f8_Icon%20Right.svg">
                                    <div class="body-small-500 text-color-gray-04">01 OUTUBRO</div>
                                </div>
                                <div class="dot-separator"></div>
                                <div class="body-small-500-2 text-color-gray-04">APOSENTADO(A)</div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
    integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>



<script>
    const API_AUTH_URL = "https://{API_NAME}.capef.com.br/auth/access-token";
    const API_BIRTHDAY_NAME_URL =
        "https://apianiversario.capef.com.br/Consultar/PorNome?Nome={NAME_VALUE}";
    const API_BIRTHDAY_DATE_URL =
        "https://apianiversario.capef.com.br/Consultar/Dia/{DAY_VALUE}/Mes/{MONTH_VALUE}";

    const API_NAMES = {
        apiAniversario: "apianiversario",
    };

    const day = $("#dia");
    const month = $("#mes");
    const dateTag = $("#date-tag");
    const submitButton = $("#birthday-submit");
    const loadingIcon = $("#loading-icon");
    const preloader = $(".preloader");

    // set preloader and loader style
    loadingIcon.style.background = "#28343e";
    loadingIcon.style.padding = "10px";
    loadingIcon.style.borderRadius = "6px";
    // black box shadow
    loadingIcon.style.boxShadow =
        "0px 0px 0px 1px rgba(0, 0, 0, 0.1), 0px 2px 4px rgba(0, 0, 0, 0.2)";

    preloader.style.display = "none";
    preloader.style.opacity = 1;
    preloader.style.position = "fixed";
    preloader.style.top = 0;
    preloader.style.left = 0;
    preloader.style.width = "100%";
    preloader.style.height = "100%";

    dateTag.style.width = "119px";

    const nameSelect = document.getElementById("Pesquisar-por-nome");
    const daySelect = document.getElementById("mes");
    const monthSelect = document.getElementById("dia");

    nameSelect.addEventListener("keyup", function () {
        const nameText = nameSelect.value;
        if (nameText.length > 0) {
            daySelect.disabled = true
            monthSelect.disabled = true
        } else {
            daySelect.disabled = false
            monthSelect.disabled = false
        }
    });

    function atualizarDias() {
        const mes = +document.getElementById("mes").value; // Converter o valor de mes para um número inteiro
        const diasSelect = document.getElementById("dia");
        diasSelect.disabled = false;

        // Remove todas as opções existentes
        diasSelect.innerHTML = "";

        // Define o número de dias baseado no mês selecionado
        let numDias = 31;
        if (mes === 4 || mes === 6 || mes === 9 || mes === 11) {
            numDias = 30;
        } else if (mes === 2) {
            numDias = 29;
        }

        // Popula o dropdown de dias com as opções
        for (let i = 1; i <= numDias; i++) {
            const option = document.createElement("option");
            option.value = i;
            option.text = i;
            diasSelect.appendChild(option);
        }
    }

    function setCurrentDate() {
        // Format dob
        const currentDate = new Date();
        // Get current date day
        const currentDay = currentDate.getDate().toString();
        // Get current date month number
        const currentMonth = currentDate.getMonth() + 1;

        // Set current date month
        month.value = currentMonth;

        // Update days
        atualizarDias();

        // Set current date day
        day.value = currentDay;

        // click on submitButton
        submitButton.click();
    }

    function $(selector) {
        return document.querySelector(selector);
    }

    async function getToken(apiName) {
        return await fetch(API_AUTH_URL.replace("{API_NAME}", apiName), {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username: "Hero99",
                password: "d7OwsEqTXc",
            }),
        })
            .then((result) => result.json())
            .catch((error) => console.log("🚀 ~ error:", error));
    }

    const getRequestOptions = (accessToken) => {
        return {
            method: "GET",
            headers: {
                Accept: "application/json",
                Authorization: `Bearer ${accessToken}`,
            },
            redirect: "follow",
        };
    };

    const makeAuthorizedRequest = async (url, apiName) => {
        const token = await getToken(API_NAMES[apiName]);
        const options = getRequestOptions(token.access_Token);

        return await fetch(url, options)
            .then((response) => response.json())
            .catch((error) => {

            });
    };

    const birthdayResponse = async ({ name, date }) => {
        let url;

        if (name) {
            dateTag.style.display = "none";
            url = API_BIRTHDAY_NAME_URL.replace("{NAME_VALUE}", name);
        } else if (date) {
            const birthdayMonthText = month.options[month.selectedIndex].textContent;
            const birthdayMonth = $("#birthday-month");
            const birthdayDay = $("#birthday-day");
            dateTag.style.display = "flex";
            birthdayMonth.innerHTML = birthdayMonthText;
            birthdayDay.innerHTML = day.value.toString().padStart(2, "0");
            url = API_BIRTHDAY_DATE_URL.replace("{DAY_VALUE}", date.day).replace(
                "{MONTH_VALUE}",
                date.month
            );
        }

        return makeAuthorizedRequest(url, "apiAniversario");
    };

    function createElement(tag, ...classes) {
        const element = document.createElement(tag);
        element.classList.add(...classes);
        return element;
    }

    function createListItem(element) {
        const listItem = createElement("li", "list-item");
        const lDot = createElement("div", "l-dot");
        const dot = createElement("div", "dot");
        const lNameList = createElement("div", "l-name-list");
        const name = createElement("div", "body-normal-600");
        const status = createElement("div", "body-small-500-2", "text-color-gray-04");
        const dotSeparator = createElement("div", "dot-separator");
        const dob = createElement("div", "body-small-500", "text-color-gray-04");
        const dobIcon = createElement("img", "date-icon");
        dobIcon.src =
            "https://assets.website-files.com/639787ef2df6f2cf951c2cba/6423a6d521de6a4d059dd8f8_Icon%20Right.svg";
        // Format dob
        const dobDate = new Date(element.dataNasc);
        // Get dob day
        const dobDay = dobDate.getDate().toString().padStart(2, "0");
        // Get dob month number
        const dobMonth = dobDate.getMonth() + 1;
        // Get dob month name
        const dobMonthName = document.querySelector(
            "select#mes option[value='" + dobMonth + "']"
        ).textContent;

        const dobText = document.createTextNode(
            dobDay + " " + dobMonthName.toUpperCase()
        );
        const nameText = document.createTextNode(element.nome);
        const statusText = document.createTextNode(element.status);
        const infoWrapper = createElement("div", "birthday-info");
        const dobWrapper = createElement("div", "birthday-date");

        name.appendChild(nameText);
        status.appendChild(statusText);
        dob.appendChild(dobText);

        dobWrapper.appendChild(dobIcon);
        dobWrapper.appendChild(dob);

        infoWrapper.appendChild(dobWrapper);
        infoWrapper.appendChild(dotSeparator);
        infoWrapper.appendChild(status);

        lNameList.appendChild(name);
        lNameList.appendChild(infoWrapper);
        lDot.appendChild(dot);
        lDot.appendChild(lNameList);
        listItem.appendChild(lDot);

        return listItem;
    }

    async function searchBirthdays() {
        preloader.style.display = "flex";
        const name = $("#Pesquisar-por-nome").value.trim();
        const date = { month: month.value, day: day.value };

        const response = await birthdayResponse({ name, date });

        console.log("response ====> ", response)

        const list = $("#birthday-list");
        list.innerHTML = "";

        if (response.length) {
            const items = response.map(createListItem);
            items.forEach((item) => list.appendChild(item));
        } else {
            //show error

        }
        preloader.style.display = "none";
    }

    submitButton.addEventListener("click", searchBirthdays);

    // set current date
    setCurrentDate();

</script>